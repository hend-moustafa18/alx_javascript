<!-- 3-index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login and Welcome</title>
</head>
<body>
    <script>
        // grab the input type text for firstname and email
        const firstname = document.getElementById('firstname');
        const email = document.getElementById('email');

        // Function setCookies that should set the cookie firstname, email
        function setCookies() {
            // 10 days in seconds
            const tenDays = 10 * 24 * 60 * 60;
            // variable that holds the current date
            const currentDate = new Date();
            // variable that holds the expiration date
            const date = new Date(currentDate.getTime() + tenDays * 1000);
            const expirationDate = date.toUTCString();
            // Modify cookies to expire in 10 days
            document.cookie = `firstname=${firstname.value}; expires=${expirationDate}; path=/`;
            document.cookie = `email=${email.value}; expires=${expirationDate}; path=/`;

            // reset the value to the initial value defined in placeholder
            firstname.value = '';
            email.value = '';
        }

        function showCookies() {
            // getting cookies in the variables
            let cemail = getCookie('email');
            let cfirstname = getCookie('firstname');
            // grab the div element to add p element inside it
            let addPara = document.getElementById('cookie');
            // create a DOM element p
            let p = document.createElement('p');

            // set the inner html with Email: EMAIL - Firstname: FIRSTNAME
            p.innerText = 'Email: ' + cemail + '- Firstname: ' + cfirstname;
            // append the paragraph at the bottom of the page
            addPara.appendChild(p);
        }

        // Add function getCookie
        function getCookie(name) {
            const cookies = document.cookie.split("; ");
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].split("=");
                if (cookie[0] === name) {
                    return cookie[1];
                }
            }
            return " ";
        }

        // Add function showForm
        function showForm() {
            const welcomeMessage = document.getElementById('welcomeMessage');
            const loginForm = document.getElementById('loginForm');

            if (welcomeMessage) {
                welcomeMessage.remove();
            }

            loginForm.style.display = 'block';
        }

        // Add function hideForm
        function hideForm() {
            const loginForm = document.getElementById('loginForm');
            loginForm.style.display = 'none';
        }

        // Add function deleteCookiesAndShowForm
        function deleteCookiesAndShowForm() {
            document.cookie = 'firstname=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            document.cookie = 'email=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            showForm();
        }

        // Add function showWelcomeMessageOrForm
        function showWelcomeMessageOrForm() {
            const welcomeMessage = document.getElementById('welcomeMessage');
            const loginForm = document.getElementById('loginForm');
            const body = document.body;

            const cfirstname = getCookie('firstname');

            if (cfirstname.trim() === "") {
                // User is not logged in
                showForm();
            } else {
                // User is logged in
                const h1 = document.createElement('h1');
                const logoutLink = document.createElement('a');
                logoutLink.href = '#';
                logoutLink.innerText = '(logout)';
                logoutLink.style.fontStyle = 'italic';
                logoutLink.style.fontWeight = 'normal';
                logoutLink.style.marginLeft = '10px';

                logoutLink.onclick = function () {
                    deleteCookiesAndShowForm();
                    hideForm();
                    welcomeMessage.remove();
                    showForm();
                };

                h1.innerText = 'Welcome ' + cfirstname;
                h1.appendChild(logoutLink);

                // Replace the body with the welcome message
                body.innerHTML = '';
                body.appendChild(h1);
            }
        }

        // Initial call to check whether to show the form or the welcome message
        showWelcomeMessageOrForm();
    </script>

    <div id="loginForm">
        <h2>Login to the website</h2>
        <input type="text" id="firstname" placeholder="Firstname">
        <input type="text" id="email" placeholder="Email">
        <button onclick="setCookies()">Log me in</button>
    </div>

    <div id="cookie"></div>

</body>
</html>
